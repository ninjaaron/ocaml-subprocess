<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Core (subprocess.Subprocess.Core)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">Index</a> &#x00BB; <a href="../../index.html">subprocess</a> &#x00BB; <a href="../index.html">Subprocess</a> &#x00BB; Core</nav><header class="odoc-preamble"><h1>Module <code><span>Subprocess.Core</span></code></h1><p>Here follows the interface defined in the <code>Core</code> module. This module is included in most of the user-facing modules for convenience, so you may stumble across its documentation in several places.</p><p>The interface defined here is needed to do almost anything with the library.</p><p>We begin with a set of placeholder types which are used to represent handles to the i/o streams of running processes (namely, stdin, stdout and stderr). Since only streams that have pipes in the parent process are really interactive in any way, these non-interactive place holders are used in other cases. Their main function is to provide type-level information about the streams.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-stdin"><a href="#type-stdin" class="anchor"></a><code><span><span class="keyword">type</span> stdin</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-stdout"><a href="#type-stdout" class="anchor"></a><code><span><span class="keyword">type</span> stdout</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-stderr"><a href="#type-stderr" class="anchor"></a><code><span><span class="keyword">type</span> stderr</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-channel"><a href="#type-channel" class="anchor"></a><code><span><span class="keyword">type</span> channel</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-devnull"><a href="#type-devnull" class="anchor"></a><code><span><span class="keyword">type</span> devnull</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-file"><a href="#type-file" class="anchor"></a><code><span><span class="keyword">type</span> file</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-append"><a href="#type-append" class="anchor"></a><code><span><span class="keyword">type</span> append</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-pipe"><a href="#type-pipe" class="anchor"></a><code><span><span class="keyword">type</span> pipe</span></code></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Subprocess_error"><a href="#exception-Subprocess_error" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Subprocess_error</span> <span class="keyword">of</span> string</span></code></div><div class="spec-doc"><p>When the library raises, it always raises a Subprocess_error of string.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Cmd"><a href="#module-Cmd" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Cmd/index.html">Cmd</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>home of Cmd.t, which is kind of the whole basis of the thing.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Exit"><a href="#module-Exit" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Exit/index.html">Exit</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>types for exit status with lots of extra info for fun and profit.</p></div></div><p>In and Out are I/O wrappers for process streams. It's thanks to these bad boys we can have such verbose types.</p><div class="odoc-spec"><div class="spec module anchored" id="module-In"><a href="#module-In" class="anchor"></a><code><span><span class="keyword">module</span> <a href="In/index.html">In</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Out"><a href="#module-Out" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Out/index.html">Out</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>('stdin, 'stdout, 'stderr) t</span></span><span> = </span><span>{</span></code><ol><li id="type-t.pid" class="def record field anchored"><a href="#type-t.pid" class="anchor"></a><code><span>pid : int;</span></code></li><li id="type-t.cmd" class="def record field anchored"><a href="#type-t.cmd" class="anchor"></a><code><span>cmd : <span><span>(<span class="type-var">'stdin</span>, <span class="type-var">'stdout</span>, <span class="type-var">'stderr</span>)</span> <a href="Cmd/index.html#type-t">Cmd.t</a></span>;</span></code></li><li id="type-t.stdin" class="def record field anchored"><a href="#type-t.stdin" class="anchor"></a><code><span>stdin : <span><span class="type-var">'stdin</span> <a href="In/index.html#type-t">In.t</a></span>;</span></code></li><li id="type-t.stdout" class="def record field anchored"><a href="#type-t.stdout" class="anchor"></a><code><span>stdout : <span><span class="type-var">'stdout</span> <a href="Out/index.html#type-t">Out.t</a></span>;</span></code></li><li id="type-t.stderr" class="def record field anchored"><a href="#type-t.stderr" class="anchor"></a><code><span>stderr : <span><span class="type-var">'stderr</span> <a href="Out/index.html#type-t">Out.t</a></span>;</span></code></li><li id="type-t.close" class="def record field anchored"><a href="#type-t.close" class="anchor"></a><code><span>close : <span><span class="optlabel">?mode</span>:<span><span class="xref-unresolved">Unix</span>.wait_flag list</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="Exit/index.html#type-t">Exit.t</a>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>The type <a href="#type-t"><code>t</code></a> represents a process which may still be running. Some of the higher-level functions don't expose it directly, but almost everything else is implemented in terms of this type.</p><p>Apply <code>()</code> to the <code>close</code> property to close any managed file descriptors and wait for the process to exit.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp"><a href="#val-pp" class="anchor"></a><code><span><span class="keyword">val</span> pp : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'stdin</span>, <span class="type-var">'stdout</span>, <span class="type-var">'stderr</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Obligatory pretty printer, for your debugging pleasure.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-show"><a href="#val-show" class="anchor"></a><code><span><span class="keyword">val</span> show : <span><span><span>(<span class="type-var">'stdin</span>, <span class="type-var">'stdout</span>, <span class="type-var">'stderr</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> string</span></code></div></div><p>What follows are some helper functions which fetch pipes to a running process for interactive reading and writting. They shadow channels with the same names in the standard library. Probably a good reason to only open <code>Subprocess</code> within a limited scope.</p><p>If you try to use one of these functions to access a stream which isn't a pipe, it's a type error.</p><div class="odoc-spec"><div class="spec value anchored" id="val-stdin"><a href="#val-stdin" class="anchor"></a><code><span><span class="keyword">val</span> stdin : <span><span><span>(<a href="#type-pipe">pipe</a>, <span class="type-var">'stdout</span>, <span class="type-var">'stderr</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Stdlib</span>.out_channel</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-stdout"><a href="#val-stdout" class="anchor"></a><code><span><span class="keyword">val</span> stdout : <span><span><span>(<span class="type-var">'stdin</span>, <a href="#type-pipe">pipe</a>, <span class="type-var">'stderr</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Stdlib</span>.in_channel</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-stderr"><a href="#val-stderr" class="anchor"></a><code><span><span class="keyword">val</span> stderr : <span><span><span>(<span class="type-var">'stdin</span>, <span class="type-var">'stdout</span>, <a href="#type-pipe">pipe</a>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Stdlib</span>.in_channel</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait"><a href="#val-wait" class="anchor"></a><code><span><span class="keyword">val</span> wait : 
  <span><span class="optlabel">?mode</span>:<span><span class="xref-unresolved">Unix</span>.wait_flag list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'stdin</span>, <span class="type-var">'stdout</span>, <span class="type-var">'stderr</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  int * <a href="Exit/index.html#type-status">Exit.status</a></span></code></div><div class="spec-doc"><p>Teeny, tiny, leaky wrapper for <code>Unix.waitpid</code> refer to its documentation</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-poll"><a href="#val-poll" class="anchor"></a><code><span><span class="keyword">val</span> poll : <span><span><span>(<span class="type-var">'stdin</span>, <span class="type-var">'stdout</span>, <span class="type-var">'stderr</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="Exit/index.html#type-status">Exit.status</a> option</span></span></code></div><div class="spec-doc"><p>Find out if your process has finished executing.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-cmd"><a href="#val-cmd" class="anchor"></a><code><span><span class="keyword">val</span> cmd : 
  <span><span class="optlabel">?prog</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?env</span>:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?block</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-stdin">stdin</a>, <a href="#type-stdout">stdout</a>, <a href="#type-stderr">stderr</a>)</span> <a href="Cmd/index.html#type-t">Cmd.t</a></span></span></code></div><div class="spec-doc"><p>Helper funtions for constructing Cmd.t. The optional <code>prog</code> argument is mainly for if you don't want your path to be searched for the executable.</p><p><code>env</code> is a list of strings with the format <code>&quot;NAME=value&quot;</code>. <code>block</code> may be set to <code>false</code> for non-blocking I/O on pipes. This one setting is used with any pipes which are used for I/O. Remember to catch <code>Sys_blocked_io</code> when doing I/O with any non-blocking pipes.</p><p>Both <code>env</code> and <code>block</code> can also be set with combinators.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pipe_in"><a href="#val-pipe_in" class="anchor"></a><code><span><span class="keyword">val</span> pipe_in : <span><span><span>(<a href="#type-stdin">stdin</a>, <span class="type-var">'stdout</span>, <span class="type-var">'stderr</span>)</span> <a href="Cmd/index.html#type-t">Cmd.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-pipe">pipe</a>, <span class="type-var">'stdout</span>, <span class="type-var">'stderr</span>)</span> <a href="Cmd/index.html#type-t">Cmd.t</a></span></span></code></div><div class="spec-doc"><p>redirect stdin to a pipe for writing.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pipe_out"><a href="#val-pipe_out" class="anchor"></a><code><span><span class="keyword">val</span> pipe_out : <span><span><span>(<span class="type-var">'stdin</span>, <a href="#type-stdout">stdout</a>, <span class="type-var">'stderr</span>)</span> <a href="Cmd/index.html#type-t">Cmd.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'stdin</span>, <a href="#type-pipe">pipe</a>, <span class="type-var">'stderr</span>)</span> <a href="Cmd/index.html#type-t">Cmd.t</a></span></span></code></div><div class="spec-doc"><p>redirect stdout to a pipe for reading.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pipe_err"><a href="#val-pipe_err" class="anchor"></a><code><span><span class="keyword">val</span> pipe_err : <span><span><span>(<span class="type-var">'stdin</span>, <span class="type-var">'stdout</span>, <a href="#type-stderr">stderr</a>)</span> <a href="Cmd/index.html#type-t">Cmd.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'stdin</span>, <span class="type-var">'stdout</span>, <a href="#type-pipe">pipe</a>)</span> <a href="Cmd/index.html#type-t">Cmd.t</a></span></span></code></div><div class="spec-doc"><p>redirect stdout to a pipe for writing.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-channel_in"><a href="#val-channel_in" class="anchor"></a><code><span><span class="keyword">val</span> channel_in : 
  <span><span class="xref-unresolved">Stdlib</span>.in_channel <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="#type-stdin">stdin</a>, <span class="type-var">'stdout</span>, <span class="type-var">'stderr</span>)</span> <a href="Cmd/index.html#type-t">Cmd.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-channel">channel</a>, <span class="type-var">'stdout</span>, <span class="type-var">'stderr</span>)</span> <a href="Cmd/index.html#type-t">Cmd.t</a></span></span></code></div><div class="spec-doc"><p>redirect stdin to an in_channel.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-channel_out"><a href="#val-channel_out" class="anchor"></a><code><span><span class="keyword">val</span> channel_out : 
  <span><span class="xref-unresolved">Stdlib</span>.out_channel <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'stdin</span>, <a href="#type-stdout">stdout</a>, <span class="type-var">'stderr</span>)</span> <a href="Cmd/index.html#type-t">Cmd.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'stdin</span>, <a href="#type-channel">channel</a>, <span class="type-var">'stderr</span>)</span> <a href="Cmd/index.html#type-t">Cmd.t</a></span></span></code></div><div class="spec-doc"><p>redirect stdout to an out_channel.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-channel_err"><a href="#val-channel_err" class="anchor"></a><code><span><span class="keyword">val</span> channel_err : 
  <span><span class="xref-unresolved">Stdlib</span>.out_channel <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'stdin</span>, <span class="type-var">'stdout</span>, <a href="#type-stderr">stderr</a>)</span> <a href="Cmd/index.html#type-t">Cmd.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'stdin</span>, <span class="type-var">'stdout</span>, <a href="#type-channel">channel</a>)</span> <a href="Cmd/index.html#type-t">Cmd.t</a></span></span></code></div><div class="spec-doc"><p>redirect stderr to an out_channel.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-file_in"><a href="#val-file_in" class="anchor"></a><code><span><span class="keyword">val</span> file_in : 
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="#type-stdin">stdin</a>, <span class="type-var">'stdout</span>, <span class="type-var">'stderr</span>)</span> <a href="Cmd/index.html#type-t">Cmd.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-file">file</a>, <span class="type-var">'stdout</span>, <span class="type-var">'stderr</span>)</span> <a href="Cmd/index.html#type-t">Cmd.t</a></span></span></code></div><div class="spec-doc"><p>redirect stdin to an named file. Similar to <code>&lt;</code> in the shell.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-file_out"><a href="#val-file_out" class="anchor"></a><code><span><span class="keyword">val</span> file_out : 
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'stdin</span>, <a href="#type-stdout">stdout</a>, <span class="type-var">'stderr</span>)</span> <a href="Cmd/index.html#type-t">Cmd.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'stdin</span>, <a href="#type-file">file</a>, <span class="type-var">'stderr</span>)</span> <a href="Cmd/index.html#type-t">Cmd.t</a></span></span></code></div><div class="spec-doc"><p>redirect stdout to an named file. Similar to <code>&gt;</code> in the shell.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-file_err"><a href="#val-file_err" class="anchor"></a><code><span><span class="keyword">val</span> file_err : 
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'stdin</span>, <span class="type-var">'stdout</span>, <a href="#type-stderr">stderr</a>)</span> <a href="Cmd/index.html#type-t">Cmd.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'stdin</span>, <span class="type-var">'stdout</span>, <a href="#type-file">file</a>)</span> <a href="Cmd/index.html#type-t">Cmd.t</a></span></span></code></div><div class="spec-doc"><p>redirect stderr to an named file. Similar to <code>2&gt;</code> in the shell.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-append_out"><a href="#val-append_out" class="anchor"></a><code><span><span class="keyword">val</span> append_out : 
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'stdin</span>, <a href="#type-stdout">stdout</a>, <span class="type-var">'stderr</span>)</span> <a href="Cmd/index.html#type-t">Cmd.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'stdin</span>, <a href="#type-append">append</a>, <span class="type-var">'stderr</span>)</span> <a href="Cmd/index.html#type-t">Cmd.t</a></span></span></code></div><div class="spec-doc"><p>redirect stdout to an named file for appending. Similar to <code>&gt;&gt;</code> in the shell.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-append_err"><a href="#val-append_err" class="anchor"></a><code><span><span class="keyword">val</span> append_err : 
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'stdin</span>, <span class="type-var">'stdout</span>, <a href="#type-stderr">stderr</a>)</span> <a href="Cmd/index.html#type-t">Cmd.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'stdin</span>, <span class="type-var">'stdout</span>, <a href="#type-append">append</a>)</span> <a href="Cmd/index.html#type-t">Cmd.t</a></span></span></code></div><div class="spec-doc"><p>redirect stderr to an named file for appending. Similar to <code>2&gt;&gt;</code> in the shell.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-devnull_out"><a href="#val-devnull_out" class="anchor"></a><code><span><span class="keyword">val</span> devnull_out : 
  <span><span><span>(<span class="type-var">'stdin</span>, <a href="#type-stdout">stdout</a>, <span class="type-var">'stderr</span>)</span> <a href="Cmd/index.html#type-t">Cmd.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'stdin</span>, <a href="#type-devnull">devnull</a>, <span class="type-var">'stderr</span>)</span> <a href="Cmd/index.html#type-t">Cmd.t</a></span></span></code></div><div class="spec-doc"><p>redirect stdout to /dev/null. similar to <code>&gt; /dev/null</code> in the shell</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-devnull_err"><a href="#val-devnull_err" class="anchor"></a><code><span><span class="keyword">val</span> devnull_err : 
  <span><span><span>(<span class="type-var">'stdin</span>, <span class="type-var">'stdout</span>, <a href="#type-stderr">stderr</a>)</span> <a href="Cmd/index.html#type-t">Cmd.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'stdin</span>, <span class="type-var">'stdout</span>, <a href="#type-devnull">devnull</a>)</span> <a href="Cmd/index.html#type-t">Cmd.t</a></span></span></code></div><div class="spec-doc"><p>redirect stderr to /dev/null. similar to <code>2&gt; /dev/null</code> in the shell</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-env"><a href="#val-env" class="anchor"></a><code><span><span class="keyword">val</span> env : 
  <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'stdin</span>, <span class="type-var">'stdout</span>, <span class="type-var">'stderr</span>)</span> <a href="Cmd/index.html#type-t">Cmd.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'stdin</span>, <span class="type-var">'stdout</span>, <span class="type-var">'stderr</span>)</span> <a href="Cmd/index.html#type-t">Cmd.t</a></span></span></code></div><div class="spec-doc"><p>Set additional environment variables. Variables are passed in as a list of strings with the format <code>&quot;NAME=value&quot;</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-no_block"><a href="#val-no_block" class="anchor"></a><code><span><span class="keyword">val</span> no_block : 
  <span><span><span>(<span class="type-var">'stdin</span>, <span class="type-var">'stdout</span>, <span class="type-var">'stderr</span>)</span> <a href="Cmd/index.html#type-t">Cmd.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'stdin</span>, <span class="type-var">'stdout</span>, <span class="type-var">'stderr</span>)</span> <a href="Cmd/index.html#type-t">Cmd.t</a></span></span></code></div><div class="spec-doc"><p>Use non-blocking I/O on any pipes. When doing I/O with any such channel, you must catch <code>Sys_blocked_io</code> in the event no data is ready for reading.</p></div></div></div></body></html>
