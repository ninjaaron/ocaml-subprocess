<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Subprocess (subprocess.Subprocess)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">subprocess</a> &#x00BB; Subprocess</nav><header class="odoc-preamble"><h1>Module <code><span>Subprocess</span></code></h1><p>A library to simplify running and working with commands on Unix.</p><p>It is recommended to use <a href="Context/index.html#val-create"><code>Context.create</code></a> to interact with a running process rather than simply using <a href="#val-create"><code>create</code></a>, as this will ensure that the process and its associated file handles will be correctly shut down.</p><p>In order to create a process and wait for it to exit, use <a href="#val-run"><code>run</code></a> or <a href="#val-run_check"><code>run_check</code></a>. <a href="#val-fold"><code>fold</code></a> may be useful for iterating line-by-line over long output streams.</p><p>All interfaces in this library are &quot;safe&quot; with untrusted input in the sense that a shell is never invoked and shell injection is impossible. Everything is implemented in terms of <code>Unix.create_process</code>, which uses <code>execvp</code> internally.</p><p>Note that there currently is not a way to trigger early termination of a subprocess with this library. Perhaps there will be one day, when I need it. Otherwise, use the <code>pid</code> and refer to the <code>Unix</code> module for closing processes.</p><ul class="at-tags"><li class="author"><span class="at-tag">author</span> Aaron Christianson</li></ul></header><div class="odoc-content"><div class="odoc-spec"><div class="spec module anchored" id="module-Unix"><a href="#module-Unix" class="anchor"></a><code><span><span class="keyword">module</span> Unix</span><span> = <span class="xref-unresolved">UnixLabels</span></span></code></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Subprocess_error"><a href="#exception-Subprocess_error" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Subprocess_error</span> <span class="keyword">of</span> string</span></code></div><div class="spec-doc"><p>This library prefers result types in general. This exception is only raised when there is a programming error of invalid input values. Such cases are annotated below.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span><span> = </span><span>{</span></code><ol><li id="type-t.pid" class="def record field anchored"><a href="#type-t.pid" class="anchor"></a><code><span>pid : int;</span></code></li><li id="type-t.stdin" class="def record field anchored"><a href="#type-t.stdin" class="anchor"></a><code><span>stdin : <span><span class="xref-unresolved">Stdlib</span>.out_channel option</span>;</span></code></li><li id="type-t.stdout" class="def record field anchored"><a href="#type-t.stdout" class="anchor"></a><code><span>stdout : <span><span class="xref-unresolved">Stdlib</span>.in_channel option</span>;</span></code></li><li id="type-t.stderr" class="def record field anchored"><a href="#type-t.stderr" class="anchor"></a><code><span>stderr : <span><span class="xref-unresolved">Stdlib</span>.in_channel option</span>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>the type of an opened process. stdin, stdout and stderr are channels with which to communicate with the process if the stream was set to `Pipe.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-completed"><a href="#type-completed" class="anchor"></a><code><span><span class="keyword">type</span> completed</span><span> = </span><span>{</span></code><ol><li id="type-completed.pid" class="def record field anchored"><a href="#type-completed.pid" class="anchor"></a><code><span>pid : int;</span></code></li><li id="type-completed.status" class="def record field anchored"><a href="#type-completed.status" class="anchor"></a><code><span>status : <span class="xref-unresolved">Unix</span>.process_status;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>the type of a process which has been closed</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-poll"><a href="#val-poll" class="anchor"></a><code><span><span class="keyword">val</span> poll : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Unix</span>.process_status option</span></span></code></div><div class="spec-doc"><p>check if process <code>t</code> has finished executing. If not, return <code>None</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-close"><a href="#val-close" class="anchor"></a><code><span><span class="keyword">val</span> close : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-completed">completed</a></span></code></div><div class="spec-doc"><p>wait for process to complete, close any file handles and return completed process instance.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check"><a href="#val-check" class="anchor"></a><code><span><span class="keyword">val</span> check : <span><a href="#type-completed">completed</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-completed">completed</a>, string)</span> <span class="xref-unresolved">Stdlib</span>.Result.t</span></span></code></div><div class="spec-doc"><p>return and <code>Error of string</code> if status code is not zero.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-input_t"><a href="#type-input_t" class="anchor"></a><code><span><span class="keyword">type</span> input_t</span><span> = </span><span>[ </span></code><ol><li id="type-input_t.Fd" class="def variant constructor anchored"><a href="#type-input_t.Fd" class="anchor"></a><code><span>| </span><span>`Fd <span class="keyword">of</span> <span class="xref-unresolved">Unix</span>.file_descr</span></code></li><li id="type-input_t.In_channel" class="def variant constructor anchored"><a href="#type-input_t.In_channel" class="anchor"></a><code><span>| </span><span>`In_channel <span class="keyword">of</span> <span class="xref-unresolved">Stdlib</span>.in_channel</span></code></li><li id="type-input_t.Pipe" class="def variant constructor anchored"><a href="#type-input_t.Pipe" class="anchor"></a><code><span>| </span><span>`Pipe</span></code></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p>Type for the stdin argument of process-creating functions in this library.</p><p>Using <code>`Pipe</code> will generate a handle for writing to the stdin of the created process.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-output_t"><a href="#type-output_t" class="anchor"></a><code><span><span class="keyword">type</span> output_t</span><span> = </span><span>[ </span></code><ol><li id="type-output_t.Fd" class="def variant constructor anchored"><a href="#type-output_t.Fd" class="anchor"></a><code><span>| </span><span>`Fd <span class="keyword">of</span> <span class="xref-unresolved">Unix</span>.file_descr</span></code></li><li id="type-output_t.Out_channel" class="def variant constructor anchored"><a href="#type-output_t.Out_channel" class="anchor"></a><code><span>| </span><span>`Out_channel <span class="keyword">of</span> <span class="xref-unresolved">Stdlib</span>.out_channel</span></code></li><li id="type-output_t.Pipe" class="def variant constructor anchored"><a href="#type-output_t.Pipe" class="anchor"></a><code><span>| </span><span>`Pipe</span></code></li><li id="type-output_t.Devnull" class="def variant constructor anchored"><a href="#type-output_t.Devnull" class="anchor"></a><code><span>| </span><span>`Devnull</span></code></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p>Type for the stdout and stderr argument of process-creating functions in this library.</p><p>Using <code>`Pipe</code> will generate a handle for reading from the specified stream of the created process.</p><p>Using <code>`Devnull</code> will cause output to be ignored.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : 
  <span><span class="optlabel">?stdin</span>:<span>[&lt; <a href="#type-input_t">input_t</a> Fd ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?stdout</span>:<span>[&lt; <a href="#type-output_t">output_t</a> Fd ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?stderr</span>:<span>[&lt; <a href="#type-output_t">output_t</a> Fd ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>string array</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>create a process with the command and arguments in an array. stdin, stdout and stderr are inherited from the current process by default. See <a href="#type-input_t"><code>input_t</code></a> and <a href="#type-output_t"><code>output_t</code></a> for more.</p><p>Note that any file handles generated by <code>`Pipe</code> are wrapped as options and will need to be unwrapped if accessed directly.</p><p>Processes should always be closed when they are no longer of use.</p><p>It is recommended to use <a href="Context/index.html#val-create"><code>Context.create</code></a> to interact with a running process rather than simply using <a href="#val-create"><code>create</code></a>, as this will ensure that the process and its associated file handles will be correctly shut down.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Context"><a href="#module-Context" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Context/index.html">Context</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>The Context module has contains a utility function to open a process interact with it in the context of closure <code>f</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-write_stdin"><a href="#val-write_stdin" class="anchor"></a><code><span><span class="keyword">val</span> write_stdin : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>write a string to the stdin of the process. raise <code>Stdlib.Invalid_argument</code> if stdin was not opened with <code>`Pipe</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-line"><a href="#val-line" class="anchor"></a><code><span><span class="keyword">val</span> line : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>string option</span></span></code></div><div class="spec-doc"><p>read a line from the stdin of the process.</p><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p>None if end of file is reached or stdin wasn't opened with <code>`Pipe</code>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-stderr_line"><a href="#val-stderr_line" class="anchor"></a><code><span><span class="keyword">val</span> stderr_line : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>string option</span></span></code></div><div class="spec-doc"><p>Same as <code>line</code>, but for stderr</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-lines"><a href="#val-lines" class="anchor"></a><code><span><span class="keyword">val</span> lines : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="xref-unresolved">Stdlib</span>.Seq.t</span></span></code></div><div class="spec-doc"><p>Read lines from stdout as a <code>Seq.t</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-stderr_lines"><a href="#val-stderr_lines" class="anchor"></a><code><span><span class="keyword">val</span> stderr_lines : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="xref-unresolved">Stdlib</span>.Seq.t</span></span></code></div><div class="spec-doc"><p>Read lines from stderr as a <code>Seq.t</code></p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-run_in"><a href="#type-run_in" class="anchor"></a><code><span><span class="keyword">type</span> run_in</span><span> = </span><span>[ </span></code><ol><li id="type-run_in.Fd" class="def variant constructor anchored"><a href="#type-run_in.Fd" class="anchor"></a><code><span>| </span><span>`Fd <span class="keyword">of</span> <span class="xref-unresolved">Unix</span>.file_descr</span></code></li><li id="type-run_in.In_channel" class="def variant constructor anchored"><a href="#type-run_in.In_channel" class="anchor"></a><code><span>| </span><span>`In_channel <span class="keyword">of</span> <span class="xref-unresolved">Stdlib</span>.in_channel</span></code></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p>Similar to <a href="#type-input_t"><code>input_t</code></a>, but without <code>`Pipe</code>, since <a href="#val-run"><code>run</code></a> is not interactive. Use <a href="#val-write"><code>write</code></a> instead for a non-interactive way to send a string to the stdin of a process.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-run_t"><a href="#type-run_t" class="anchor"></a><code><span><span class="keyword">type</span> run_t</span><span> = </span><span>{</span></code><ol><li id="type-run_t.proc" class="def record field anchored"><a href="#type-run_t.proc" class="anchor"></a><code><span>proc : <a href="#type-completed">completed</a>;</span></code></li><li id="type-run_t.stdout" class="def record field anchored"><a href="#type-run_t.stdout" class="anchor"></a><code><span>stdout : <span>string list</span>;</span></code></li><li id="type-run_t.stderr" class="def record field anchored"><a href="#type-run_t.stderr" class="anchor"></a><code><span>stderr : <span>string list</span>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Output type of <a href="#val-run"><code>run</code></a>, <a href="#val-run_check"><code>run_check</code></a> and <a href="#val-write"><code>write</code></a>. <code>proc</code> is the completed process. stdout and stderr are lists of strings correspoding to the output of those streams from the process. They will be empty unless the corresponding stream was set to <code>`Pipe</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run"><a href="#val-run" class="anchor"></a><code><span><span class="keyword">val</span> run : 
  <span><span class="optlabel">?stdin</span>:<span>[&lt; <a href="#type-run_in">run_in</a> Fd ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?stdout</span>:<span>[&lt; <a href="#type-output_t">output_t</a> Fd ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?stderr</span>:<span>[&lt; <a href="#type-output_t">output_t</a> Fd ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>string array</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-run_t">run_t</a></span></code></div><div class="spec-doc"><p>Creates a process, waits for it to finish and returns the completed process and any collected output See <a href="#type-run_t"><code>run_t</code></a> for more details.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run_check"><a href="#val-run_check" class="anchor"></a><code><span><span class="keyword">val</span> run_check : 
  <span><span class="optlabel">?stdin</span>:<span>[&lt; <a href="#type-run_in">run_in</a> Fd ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?stdout</span>:<span>[&lt; <a href="#type-output_t">output_t</a> Fd ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?stderr</span>:<span>[&lt; <a href="#type-output_t">output_t</a> Fd ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>string array</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-run_t">run_t</a>, string)</span> <span class="xref-unresolved">Stdlib</span>.Result.t</span></span></code></div><div class="spec-doc"><p>Execute a command with <a href="#val-run"><code>run</code></a> and then check the status code. Returns <code>Error of string</code> if non-zero.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-write"><a href="#val-write" class="anchor"></a><code><span><span class="keyword">val</span> write : 
  <span><span class="optlabel">?stdout</span>:<span>[&lt; <a href="#type-output_t">output_t</a> Fd ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?stderr</span>:<span>[&lt; <a href="#type-output_t">output_t</a> Fd ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>string array</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">input</span>:string <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-run_t">run_t</a></span></code></div><div class="spec-doc"><p>Similar to <a href="#val-run"><code>run</code></a>, but writes the <code>input</code> string to stdin.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fold"><a href="#val-fold" class="anchor"></a><code><span><span class="keyword">val</span> fold : 
  <span><span class="optlabel">?stdin</span>:<span>[&lt; <a href="#type-run_in">run_in</a> Fd ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?stdout</span>:<span>[&lt; <a href="#type-output_t">output_t</a> Fd Pipe ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?stderr</span>:<span>[&lt; <a href="#type-output_t">output_t</a> Fd Pipe ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>string array</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">f</span>:<span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">init</span>:<span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-completed">completed</a> * <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p>Create a process with either stdout or stderr set to <code>`Pipe</code>, and fold over the lines of output. Returns a tuple of the <a href="#type-completed"><code>completed</code></a> process and the accumulated output.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Subprocess_error"><code>Subprocess_error</code></a> <p>if <i>neither or both</i> stdin and stderr ar set to <code>`Pipe</code>. Exactly one of these streams may be used.</p></li></ul></div></div></div></body></html>
